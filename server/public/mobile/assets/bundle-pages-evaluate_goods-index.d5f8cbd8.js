import{R as e,H as t,r as a,a as l,o as i,c as s,w as r,h as n,b as o,C as u,e as c,f as d,A as m,k as f,t as h,F as p,j as _,q as g,d as v,aa as y,B as b,aE as x,p as S,v as k,ag as w,x as I,i as C,S as B}from"./index.0909ac6c.js";import{_ as $}from"./u-badge.2b611478.js";import{_ as j}from"./plugin-vue_export-helper.21dcd24c.js";import{e as T,f as L}from"./goods.771ae366.js";import{r as N}from"./index.28561b7c.js";import{_ as z}from"./u-image.879031a5.js";import{_ as W}from"./u-rate.6a269493.js";import"./u-icon.0b85921a.js";var H=j({name:"u-tabs",emits:["update:modelValue","input","change"],props:{value:{type:[Number,String],default:0},modelValue:{type:[Number,String],default:0},current:{type:[Number,String],default:0},isScroll:{type:Boolean,default:!0},list:{type:Array,default:()=>[]},height:{type:[String,Number],default:80},fontSize:{type:[String,Number],default:30},duration:{type:[String,Number],default:.5},activeColor:{type:String,default:"#2979ff"},inactiveColor:{type:String,default:"#303133"},barWidth:{type:[String,Number],default:40},barHeight:{type:[String,Number],default:6},gutter:{type:[String,Number],default:30},bgColor:{type:String,default:"#ffffff"},name:{type:String,default:"name"},count:{type:String,default:"count"},offset:{type:Array,default:()=>[5,20]},bold:{type:Boolean,default:!0},activeItemStyle:{type:Object,default:()=>({})},showBar:{type:Boolean,default:!0},barStyle:{type:Object,default:()=>({})},itemWidth:{type:[Number,String],default:"auto"}},data(){return{scrollLeft:0,tabQueryInfo:[],componentWidth:0,scrollBarLeft:0,parentLeft:0,id:this.$u.guid(),currentIndex:this.current,barFirstTimeMove:!0}},watch:{list(e,t){e.length!==t.length&&(this.currentIndex=0),this.$nextTick((()=>{this.init()}))},current:{immediate:!0,handler(e,t){this.$nextTick((()=>{this.currentIndex=e,this.scrollByIndex()}))}},valueCom:{immediate:!0,handler(e,t){this.$nextTick((()=>{this.currentIndex=e,this.scrollByIndex()}))}}},computed:{valueCom(){return this.modelValue},tabBarStyle(){let e={width:this.barWidth+"rpx",transform:`translate(${this.scrollBarLeft}px, -100%)`,"transition-duration":`${this.barFirstTimeMove?0:this.duration}s`,"background-color":this.activeColor,height:this.barHeight+"rpx","border-radius":this.barHeight/2+"px"};return Object.assign(e,this.barStyle),e},tabItemStyle(){return e=>{let t={height:this.height+"rpx","line-height":this.height+"rpx","font-size":this.fontSize+"rpx","transition-duration":`${this.duration}s`,padding:this.isScroll?`0 ${this.gutter}rpx`:"",flex:this.isScroll?"auto":"1",width:this.$u.addUnit(this.itemWidth)};return e==this.currentIndex&&this.bold&&(t.fontWeight="bold"),e==this.currentIndex?(t.color=this.activeColor,t=Object.assign(t,this.activeItemStyle)):t.color=this.inactiveColor,t}}},methods:{async init(){let e=await this.$uGetRect("#"+this.id);this.parentLeft=e.left,this.componentWidth=e.width,this.getTabRect()},clickTab(e){e!=this.currentIndex&&(this.$emit("change",e),this.$emit("input",e),this.$emit("update:modelValue",e))},getTabRect(){let t=e().in(this);for(let e=0;e<this.list.length;e++)t.select(`#u-tab-item-${e}`).fields({size:!0,rect:!0});t.exec(function(e){this.tabQueryInfo=e,this.scrollByIndex()}.bind(this))},scrollByIndex(){let e=this.tabQueryInfo[this.currentIndex];if(!e)return;let a=e.width,l=e.left-this.parentLeft-(this.componentWidth-a)/2;this.scrollLeft=l<0?0:l;let i=e.left+e.width/2-this.parentLeft;this.scrollBarLeft=i-t(this.barWidth)/2,1==this.barFirstTimeMove&&setTimeout((()=>{this.barFirstTimeMove=!1}),100)}},mounted(){this.init()}},[["render",function(e,t,v,y,b,x){const S=a(l("u-badge"),$),k=_,w=g;return i(),s(k,{class:"u-tabs",style:m({background:v.bgColor})},{default:r((()=>[n(" $u.getRect()对组件根节点无效，因为写了.in(this)，故这里获取内层接点尺寸 "),o(k,{id:b.id},{default:r((()=>[o(w,{"scroll-x":"",class:"u-scroll-view","scroll-left":b.scrollLeft,"scroll-with-animation":""},{default:r((()=>[o(k,{class:u(["u-scroll-box",{"u-tabs-scorll-flex":!v.isScroll}])},{default:r((()=>[(i(!0),c(p,null,d(v.list,((e,t)=>(i(),s(k,{class:"u-tab-item u-line-1",id:"u-tab-item-"+t,key:t,onClick:e=>x.clickTab(t),style:m([x.tabItemStyle(t)])},{default:r((()=>[o(S,{count:e[v.count]||e.count||0,offset:v.offset,size:"mini"},null,8,["count","offset"]),f(" "+h(e[v.name]||e.name),1)])),_:2},1032,["id","onClick","style"])))),128)),v.showBar?(i(),s(k,{key:0,class:"u-tab-bar",style:m([x.tabBarStyle])},null,8,["style"])):n("v-if",!0)])),_:1},8,["class"])])),_:1},8,["scroll-left"])])),_:1},8,["id"])])),_:1},8,["style"])}],["__scopeId","data-v-ff17e798"]]);var M=j(v({__name:"card",props:{goods_id:{default:""},comment:{default:""},goods_comment_image:{default:""},reply:{default:""},create_time:{default:""},service_comment:{default:""},user:{default:{avatar:"",nickname:""}}},setup(e){const t=e;return(m,g)=>{const v=a(l("u-image"),z),k=_,w=a(l("u-rate"),W),I=S;return i(),s(k,{class:"card"},{default:r((()=>[n(" Header Start "),o(k,{class:"card--header flex row-between col-start"},{default:r((()=>[o(k,{class:"flex"},{default:r((()=>[o(v,{src:e.user.avatar,width:"80",height:"80","border-radius":"50%"},null,8,["src"]),o(k,{class:"m-l-20"},{default:r((()=>[o(k,{class:"font-md normal f-w-500"},{default:r((()=>[f(h(e.user.nickname),1)])),_:1}),o(k,{class:"muted font-xs m-t-10"},{default:r((()=>[f(h(e.create_time),1)])),_:1})])),_:1})])),_:1}),o(k,{class:"flex"},{default:r((()=>[o(w,{count:5,modelValue:e.service_comment,"onUpdate:modelValue":g[0]||(g[0]=e=>y(service_comment)?service_comment.value=e:null),size:"28","inactive-icon":"star-fill"},null,8,["modelValue"]),o(k,{class:"m-l-20 lighter font-xs"},{default:r((()=>[5==e.service_comment?(i(),s(I,{key:0},{default:r((()=>[f("非常好")])),_:1})):n("v-if",!0),4==e.service_comment?(i(),s(I,{key:1},{default:r((()=>[f("好")])),_:1})):n("v-if",!0),3==e.service_comment?(i(),s(I,{key:2},{default:r((()=>[f("一般")])),_:1})):n("v-if",!0),2==e.service_comment?(i(),s(I,{key:3},{default:r((()=>[f("差")])),_:1})):n("v-if",!0),1==e.service_comment?(i(),s(I,{key:4},{default:r((()=>[f("非常差")])),_:1})):n("v-if",!0)])),_:1})])),_:1})])),_:1}),n(" Main Start "),o(k,{class:"card--main"},{default:r((()=>[o(k,{class:"content"},{default:r((()=>[f(h(e.comment),1)])),_:1}),o(k,{class:"flex flex-wrap"},{default:r((()=>[(i(!0),c(p,null,d(e.goods_comment_image,((e,a)=>(i(),s(k,{class:u(["m-t-10",{"m-r-10":(a+1)%3!=0}]),onClick:b((e=>{x({current:a,urls:t.goods_comment_image.map((e=>e.uri))})}),["stop"])},{default:r((()=>[o(v,{src:e.uri,width:"210",height:"210"},null,8,["src"])])),_:2},1032,["class","onClick"])))),256))])),_:1}),e.reply?(i(),s(k,{key:0,class:"reply normal font-md m-t-20"},{default:r((()=>[o(I,{class:"f-w-500"},{default:r((()=>[f("商家回复: ")])),_:1}),o(I,null,{default:r((()=>[f(h(e.reply),1)])),_:1})])),_:1})):n("v-if",!0)])),_:1})])),_:1})}}}),[["__scopeId","data-v-2edf8d83"]]);var V=j(v({__name:"index",setup(e){const t=k([]),u=k([]),m=k(0),f=k(0),h=k(null),g=e=>{var t;let a;a=e.detail?e.detail.current:e,f.value=Number(a),null==(t=h.value)||t.resetUpScroll()},v=async e=>{const a=f.value;try{const l=await L({page_no:e.num,page_size:e.size,goods_id:m.value,id:t.value[a].id});1===e.num&&(u.value=[]),u.value=[...u.value,...l.lists],h.value.endSuccess(l.count)}catch(l){console.log("下拉加载",l),h.value.endErr()}},y=e=>{null!=e&&(h.value=e)};return w((e=>{m.value=e.id||0,(async()=>{try{const e=await T({goods_id:m.value});t.value=e.comment}catch(e){console.log(e)}})()})),I((()=>{var e;null==(e=h.value)||e.resetUpScroll()})),(e,m)=>{const h=a(l("u-tabs"),H),b=B,x=C,S=_;return t.value.length?(i(),s(S,{key:0,class:"container"},{default:r((()=>[n(" Header Start "),o(h,{list:t.value,"is-scroll":!0,current:f.value,onChange:g,"bg-color":"white","inactive-color":"#222222","active-color":"#F36161",height:"100"},null,8,["list","current"]),n(" Header End "),n(" Main Start "),o(S,{class:"main"},{default:r((()=>[o(x,{duration:400,onChange:g,current:f.value},{default:r((()=>[(i(!0),c(p,null,d(t.value,((e,t)=>(i(),s(b,{key:e.order_status},{default:r((()=>[t===f.value?(i(),s(N,{key:0,onUp:v,ref_for:!0,ref:y,empty:"/static/images/empty/evaluate.png",emptyText:"暂无评价数据～"},{default:r((()=>[n(' <uni-transition mode-class="zoom-in" needLayout="true" :show="listData.length" :duration="500"> '),(i(!0),c(p,null,d(u.value,((e,t)=>(i(),s(M,{key:e.id,comment:e.comment,goods_comment_image:e.goods_comment_image,reply:e.reply,create_time:e.create_time,goods_id:e.goods_id,service_comment:e.service_comment,user:e.user},null,8,["comment","goods_comment_image","reply","create_time","goods_id","service_comment","user"])))),128)),n(" </uni-transition> ")])),_:1},8,["empty"])):n("v-if",!0)])),_:2},1024)))),128))])),_:1},8,["current"])])),_:1}),n(" Main End ")])),_:1})):n("v-if",!0)}}}),[["__scopeId","data-v-764e1a38"]]);export{V as default};
